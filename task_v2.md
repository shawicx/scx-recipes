# 智能饮食助手 - 任务管理计划 v2

## 项目概述

智能饮食助手是一个基于 Tauri 的桌面应用程序，用于离线健康饮食推荐。在已完成的核心功能基础上，扩展以下高级功能：地域饮食知识库、营养与健康引擎优化、智能推荐算法改进、地理位置服务集成等。

---

## 1. 后端增强任务 (Rust + Tauri)

### 1.1 地域饮食知识库

- **任务**：构建中国各省份特色饮食数据库，并按气候、文化、食材季节性进行分类
- **技术方案**：扩展数据库模式以包含地域标签，创建地域食谱分类系统，增加季节性食材数据
- **当前阶段**：待开发
- **验收标准**：包含全国各省份特色饮食数据；支持按地域、气候、季节分类；数据结构支持高效查询和推荐
- **预估工时**：20小时

### 1.2 营养与健康引擎优化

- **任务**：集成营养数据库，实现BMR计算与热量摄入建议，三餐营养均衡分配
- **技术方案**：集成中国食物成分表数据，实现BMR计算算法，开发营养均衡推荐规则
- **当前阶段**：待开发
- **验收标准**：准确计算用户BMR；根据健康目标推荐热量摄入；实现蛋白质、碳水、脂肪等营养素均衡分配
- **预估工时**：16小时

### 1.3 高级推荐算法

- **任务**：实现基于内容的推荐、协同过滤、知识图谱等混合推荐策略
- **技术方案**：扩展推荐引擎，实现规则引擎+简单加权评分系统，为后期机器学习模型集成做准备
- **当前阶段**：待开发
- **验收标准**：实现基于内容的推荐系统；支持协同过滤推荐（数据积累后启用）；构建"食材-菜品-营养-地域"知识图谱
- **预估工时**：24小时

### 1.4 用户反馈学习机制

- **任务**：实现用户反馈收集与推荐优化
- **技术方案**：添加反馈数据模型，实现反馈处理逻辑，更新推荐算法以考虑用户反馈
- **当前阶段**：待开发
- **验收标准**：支持"点赞/踩"、"已吃"、"不想吃"等反馈；根据反馈动态优化推荐；记录用户偏好变化
- **预估工时**：12小时

### 1.5 数据导入/导出功能

- **任务**：实现用户数据的导入/导出功能
- **技术方案**：实现数据序列化/反序列化，支持JSON/CSV格式，确保数据完整性
- **当前阶段**：待开发
- **验收标准**：支持用户健康档案导出；支持食谱数据导入；支持历史记录备份/恢复
- **预估工时**：8小时

---

## 2. 前端增强任务 (React + TypeScript + Tailwind CSS + Ant Design)

### 2.1 地域饮食展示组件

- **任务**：创建展示地域特色饮食的UI组件
- **技术方案**：开发地域筛选器、地域饮食展示列表、季节性推荐面板等组件
- **当前阶段**：待开发
- **验收标准**：用户可按地域筛选食谱；显示地域特色介绍；支持季节性推荐展示
- **预估工时**：10小时

### 2.2 营养分析仪表板

- **任务**：创建详细的营养摄入分析界面
- **技术方案**：开发营养图表组件、热量摄入追踪、营养均衡分析等可视化组件
- **当前阶段**：待开发
- **验收标准**：以图表形式展示营养摄入；显示与推荐值的对比；提供营养改进建议
- **预估工时**：14小时

### 2.3 BMR计算器组件

- **任务**：创建用户BMR计算和健康目标设置界面
- **技术方案**：实现BMR计算表单、健康目标选择器、热量推荐显示等组件
- **当前阶段**：待开发
- **验收标准**：准确计算并显示用户BMR；根据目标推荐热量摄入；显示营养分配建议
- **预估工时**：8小时

### 2.4 用户反馈界面

- **任务**：创建用户反馈收集界面
- **技术方案**：开发反馈按钮、反馈记录查看、偏好调整建议等组件
- **当前阶段**：待开发
- **验收标准**：支持多种反馈形式；记录历史反馈；显示偏好调整建议
- **预估工时**：6小时

### 2.5 手动替换推荐功能

- **任务**：实现手动替换推荐餐品的界面
- **技术方案**：开发餐品搜索界面、替换推荐功能、餐品比较组件
- **当前阶段**：待开发
- **验收标准**：用户可手动替换某餐推荐；支持按偏好搜索替代品；显示替换前后营养对比
- **预估工时**：10小时

---

## 3. 集成与功能增强任务

### 3.1 地理位置服务集成（LBS）

- **任务**：集成地理位置服务，支持周边餐饮推荐
- **技术方案**：使用高德地图API + 离线Demo双模式，实现精准LBS推荐
- **当前阶段**：开发中 - 基础框架已完成，正在集成高德地图API
- **验收标准**：获取用户地理位置；支持周边餐馆搜索；区分堂食、外卖、自炊模式
- **预估工时**：20小时（已完成40%）

#### 详细实施计划

**架构设计**：双模式LBS服务

- **Demo模式**：使用静态示例数据，支持离线演示和测试
- **生产模式**：集成高德地图API，提供真实POI数据和精准定位

**已完成功能** ✅

- [x] 基础位置服务框架 (`src-tauri/src/location/mod.rs`)
- [x] IP地址定位备选方案（10km精度）
- [x] 距离计算算法（Haversine公式）
- [x] Demo数据：餐厅、外卖、食材商店搜索
- [x] 配置文件系统 (`amap_config.toml`)
- [x] API密钥安全管理
- [x] Tauri命令接口（6个LBS命令）

**开发中功能** 🚧

- [x] 高德地图API客户端 (`amap_client.rs`)
- [ ] 配置加载模块 (`amap_config.rs`)
- [ ] API响应数据类型 (`amap_types.rs`)
- [ ] 地理编码/逆地理编码 (`geocoding.rs`)
- [ ] 统一POI搜索引擎 (`poi_search.rs`)
- [ ] 路径规划服务 (`route_planning.rs`)

**计划功能** 📋

- [ ] 真实餐厅POI数据集成
- [ ] 外卖配送范围精确计算
- [ ] 食材采购路线优化
- [ ] 缓存机制（预留接入空间）
- [ ] 请求限流（预留接入空间）

#### 技术架构对比

| 功能模块     | Demo模式          | 高德地图API模式    |
| ------------ | ----------------- | ------------------ |
| **定位精度** | IP定位(~10km)     | GPS+网络(米级精度) |
| **POI数据**  | 静态示例(5个餐厅) | 全国实时POI数据库  |
| **搜索范围** | 北京示例区域      | 全国城市全覆盖     |
| **实时性**   | 静态假数据        | 营业状态/评分实时  |
| **路径规划** | 直线距离计算      | 专业导航路线       |
| **地址解析** | 不支持            | 中文地址↔坐标转换 |

#### 配置系统

**安全配置** (`amap_config.toml`):

```toml
[amap]
web_api_key = "已配置"           # ✅ 高德Web服务API密钥
base_url = "https://restapi.amap.com"
timeout = 10

[poi_search]
default_radius = 1000           # 默认搜索半径(米)
max_results = 20               # 最大结果数
restaurant_categories = ["050000", "050100", "050200"]
shopping_categories = ["060000", "060100", "060200"]

# 性能优化预留配置
[cache]                        # 缓存支持预留
enable_cache = false           # 当前不启用，预留接入空间
cache_expire_minutes = 30

[rate_limit]                   # 请求限流预留
requests_per_second = 10       # 当前不启用，预留接入空间
requests_per_day = 5000
```

#### 核心优势

**渐进式升级策略**：

- 🔄 保留Demo功能，无缝切换到真实API
- 🎯 定位精度：10km → 米级精度提升
- 📊 数据质量：静态假数据 → 实时POI数据库
- 🚀 专业功能：获得完整LBS解决方案
- 💰 成本可控：按需使用，预留优化空间

**当前可用命令**：

```rust
get_user_location()              // IP定位
search_nearby_restaurants()      // 餐厅搜索
search_delivery_options()        // 外卖搜索
search_ingredient_stores()       // 食材商店搜索
generate_shopping_list()         // 购物清单
get_quick_delivery()             // 快速外卖
```

### 3.2 食材推荐与采购功能

- **任务**：根据食谱推荐所需食材及采购地点
- **技术方案**：分析食谱所需食材，关联采购地点数据，生成购物清单
- **当前阶段**：待开发
- **验收标准**：自动生成食谱所需食材清单；推荐附近采购地点；支持购物清单管理
- **预估工时**：16小时

### 3.3 多语言国际化

- **任务**：实现多语言支持
- **技术方案**：集成i18next，添加中文/英文翻译，实现语言切换功能
- **当前阶段**：待开发
- **验收标准**：支持中文和英文界面；语言切换功能正常；保持UI一致性
- **预估工时**：10小时

### 3.4 数据统计与可视化

- **任务**：增强数据统计功能，提供可视化分析
- **技术方案**：使用图表库（如Recharts），开发统计分析接口，实现数据洞察
- **当前阶段**：待开发
- **验收标准**：提供饮食趋势分析；显示营养摄入图表；支持按时间段统计
- **预估工时**：12小时

---

## 4. 隐私与安全增强

### 4.1 隐私设置细化

- **任务**：提供更详细的隐私控制选项
- **技术方案**：扩展配置模型，实现隐私偏好管理界面，添加数据清除功能
- **当前阶段**：待开发
- **验收标准**：用户可控制数据收集范围；提供数据清除选项；明确隐私政策说明
- **预估工时**：6小时

### 4.2 数据加密存储

- **任务**：实现敏感数据的加密存储
- **技术方案**：集成加密库，实现数据加密/解密功能，确保本地存储安全
- **当前阶段**：待开发
- **验收标准**：敏感数据加密存储；加密算法安全可靠；不影响应用性能
- **预估工时**：14小时

---

## 5. 用户体验优化

### 5.1 性能优化

- **任务**：优化应用性能，提升用户体验
- **技术方案**：实现懒加载、虚拟滚动、数据库查询优化、图片压缩等
- **当前阶段**：待开发
- **验收标准**：推荐生成时间小于200ms；UI响应流畅；大数据量下仍保持高性能
- **预估工时**：12小时

### 5.2 离线功能增强

- **任务**：增强离线功能，确保无网络环境下的完整体验
- **技术方案**：优化本地数据缓存，实现离线数据同步机制，增强离线功能
- **当前阶段**：待开发
- **验收标准**：所有功能离线可用；数据在重连时同步；离线体验与在线一致
- **预估工时**：10小时

---

## 6. 测试与质量保证

### 6.1 新功能集成测试

- **任务**：对新增功能进行全面集成测试
- **技术方案**：编写端到端测试，验证新功能与现有系统的集成，自动化测试
- **当前阶段**：待开发
- **验收标准**：所有新功能通过集成测试；与现有功能无冲突；性能符合要求
- **预估工时**：16小时

### 6.2 性能与压力测试

- **任务**：对扩展功能进行性能与压力测试
- **技术方案**：模拟大量数据，测试推荐引擎性能，验证系统稳定性
- **当前阶段**：待开发
- **验收标准**：推荐生成时间满足要求；大数据集处理稳定；内存使用合理
- **预估工时**：8小时

---

## 整体项目状态摘要

- **已完成**：核心功能（后端核心、前端核心、推荐与历史、所有测试）
- **待开发**：高级功能（地域知识库、营养引擎、高级推荐算法、LBS等）
- **预估总新增工时**：约200小时

## 功能优先级排序

### 高优先级

1. 营养与健康引擎优化（16小时）
2. BMR计算器组件（8小时）
3. 高级推荐算法（24小时）
4. 营养分析仪表板（14小时）

### 中优先级

1. 地域饮食知识库（20小时）
2. 地域饮食展示组件（10小时）
3. 用户反馈学习机制（12小时）
4. 用户反馈界面（6小时）
5. 数据导入/导出功能（8小时）

### 低优先级

1. 地理位置服务集成（20小时）
2. 食材推荐与采购功能（16小时）
3. 手动替换推荐功能（10小时）
4. 数据统计与可视化（12小时）
5. 多语言国际化（10小时）
6. 其他优化任务

## 风险评估

- **中风险**：地域饮食知识库 - 需要大量真实数据
- **中风险**：高级推荐算法 - 技术复杂度较高
- **中风险**：地理位置服务集成 - 需要处理隐私和API限制
- **低风险**：其他前端界面功能 - 技术实现相对直接
- **低风险**：数据导入/导出 - 有现成库支持
